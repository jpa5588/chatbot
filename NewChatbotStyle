<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>NFL Chat</title>
    <style>
        :root {
          --nfl-blue: #013369;
          --nfl-red: #d50a0a;
          --field-green: #0b6623;
          --turf-gray: #1e1f26;
          --yardline: #ffffff30;
          --me: #01336933;
          --bot: #ffffff22;
          --text: #f5f6fa;
          --accent: #d50a0a;
        }
        * { box-sizing: border-box; }

        body {
          margin: 0;
          height: 100vh;
          display: flex;
          justify-content: center;
          align-items: center;
          font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
          color: var(--text);
          background-color: #0b6623;
          background-image:
            url("https://www.transparenttextures.com/patterns/grass.png"),
            repeating-linear-gradient(
              to bottom,
              rgba(255,255,255,0.06) 0px,
              rgba(255,255,255,0.06) 2px,
              transparent 2px,
              transparent 80px
            );
          background-size: auto, 100% 82px;
        }

        .chat {
          width: 95%;
          max-width: 900px;
          height: 90vh;
          display: flex;
          flex-direction: column;
          background:
            linear-gradient(160deg, rgba(0,0,0,0.85), rgba(10,10,15,0.95)),
            url("https://www.transparenttextures.com/patterns/football-leather.png");
          background-size: cover;
          background-blend-mode: overlay;
          border-radius: 18px;
          overflow: hidden;
          border: 3px solid #ffffff33;
          box-shadow: 0 0 50px #00000099;
        }

        .chat::before {
          content: "üèà NFL Chat Center";
          display: block;
          text-align: center;
          background: linear-gradient(to right, var(--nfl-red), var(--nfl-blue));
          padding: 14px 0;
          font-weight: 700;
          letter-spacing: 1px;
          font-size: 1.2em;
          border-bottom: 2px solid #fff2;
          color: #fff;
          text-shadow: 0 0 4px #000;
        }

        .messages {
          flex: 1;
          overflow-y: auto;
          padding: 20px;
          display: flex;
          flex-direction: column;
          gap: 10px;
          background: repeating-linear-gradient(
            to bottom,
            rgba(30,31,38,0.9),
            rgba(30,31,38,0.9) 38px,
            var(--yardline) 40px
          );
          scroll-behavior: smooth;
        }

        .msg {
          max-width: 80%;
          padding: 10px 14px;
          border-radius: 14px;
          font-size: 15px;
          line-height: 1.4;
          animation: fadeIn 0.2s ease-out;
          color: #fff;
        }
        .me {
          align-self: flex-end;
          background: linear-gradient(145deg, var(--nfl-blue), #0352a0);
          border: 1px solid #ffffff33;
        }
        .bot {
          align-self: flex-start;
          background: linear-gradient(145deg, #2b2b2b, #1a1a1a);
          border: 1px solid #ffffff11;
        }

        .inputbar {
          display: flex;
          gap: 10px;
          background: #000814;
          padding: 12px;
          border-top: 2px solid #ffffff22;
        }
        input[type=text] {
          flex: 1;
          padding: 12px;
          border-radius: 10px;
          border: 1px solid #444;
          background: #0f172a;
          color: #fff;
          font-size: 15px;
        }
        input[type=text]::placeholder { color: #ccc; }
        button {
          padding: 12px 16px;
          border-radius: 10px;
          background: linear-gradient(to right, var(--nfl-red), #a30707);
          color: #fff;
          border: none;
          cursor: pointer;
          font-weight: 600;
          transition: 0.2s;
        }
        button:hover {
          background: linear-gradient(to right, #ff3c3c, var(--nfl-red));
          transform: translateY(-1px);
        }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 10px;
          color: #fff;
          font-size: 14px;
        }
        th, td {
          padding: 8px;
          border: 1px solid #ffffff33;
          text-align: left;
        }
        th {
          background: linear-gradient(145deg, var(--nfl-blue), var(--nfl-red));
          color: #fff;
          font-weight: bold;
        }
        tr:nth-child(even) { background-color: #ffffff05; }

        .hint {
          color: #aaa;
          font-size: 13px;
          text-align: center;
          background: #000814;
          padding: 6px 0;
          border-top: 1px solid #222;
        }
        .error { color: #ff4d4d; font-weight: bold; }

        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(5px); }
          to { opacity: 1; transform: translateY(0); }
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb {
          background: linear-gradient(var(--nfl-blue), var(--nfl-red));
          border-radius: 10px;
        }
    </style>
</head>
<body>
<div class="chat">
    <div class="messages" id="messages">
        <div class="msg bot">
            Welcome to the <strong>NFL Chat Center</strong>!<br>
            Ask for standings by typing a season like <code>2024REG</code>, <code>2024PRE</code>, or <code>2024POST</code>.
        </div>
    </div>
    <div class="hint">Example: <code>2024reg</code></div>
    <form class="inputbar" id="form">
        <input id="prompt" type="text" placeholder="Type a season (e.g., 2024reg)..." autocomplete="off">
        <button id="sendBtn" type="submit">Send</button>
    </form>
</div>

<script>
    const API_KEY  = "3751b77068144fee9a5e5e5058ff5eb1";
    const API_BASE = "https://api.sportsdata.io/v3/nfl/scores/xml/Standings";
    const $ = s => document.querySelector(s);
    const messages = $("#messages");
    const seasonRegex = /^\s*(\d{4})(reg|pre|post)\s*$/i;

    function buildUrl(season) {
      return `${API_BASE}/${encodeURIComponent(season)}?key=${encodeURIComponent(API_KEY)}`;
    }

    function addMsg(html, who="bot") {
      const div = document.createElement("div");
      div.className = `msg ${who}`;
      div.innerHTML = html;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    const txt = (node, tag) => node.getElementsByTagName(tag)[0]?.textContent?.trim() ?? "";

    function renderStandingsTable(xmlDoc) {
      const items = Array.from(xmlDoc.getElementsByTagName("Standing"));
      if (!items.length) return "<div>No standings found.</div>";

      const data = items.map(s => ({
        Division: txt(s,"Division"),
        Rank: txt(s,"DivisionRank"),
        Team: txt(s,"Name"),
        W: txt(s,"Wins"),
        L: txt(s,"Losses"),
        T: txt(s,"Ties"),
        Pct: txt(s,"Percentage")
      }));

      const filterOptions = ["Division","Rank","Team","W","L","T","Pct"];
      const filterBar = `
        <div style="margin-bottom:10px;display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
          <label for="filterCol"><strong>Filter by:</strong></label>
          <select id="filterCol" style="padding:6px;border-radius:8px;background:#0f172a;color:#fff;border:1px solid #555;">
            <option value="">-- Select column --</option>
            ${filterOptions.map(o=>`<option value="${o}">${o}</option>`).join("")}
          </select>
          <input type="text" id="filterInput" placeholder="Enter value..."
            style="padding:6px;border-radius:8px;background:#0f172a;color:#fff;border:1px solid #555;">
          <button id="applyFilter" style="padding:6px 12px;border-radius:8px;background:linear-gradient(to right,#d50a0a,#a30707);color:#fff;border:none;cursor:pointer;">Apply</button>
          <button id="clearFilter" style="padding:6px 12px;border-radius:8px;background:#555;color:#fff;border:none;cursor:pointer;">Clear</button>
        </div>
      `;

      const tableHtml = `
        ${filterBar}
        <table id="standingsTable">
          <thead><tr>${filterOptions.map(o=>`<th>${o}</th>`).join("")}</tr></thead>
          <tbody>
            ${data.map(row=>`
              <tr>
                <td>${row.Division}</td>
                <td>${row.Rank}</td>
                <td>${row.Team}</td>
                <td>${row.W}</td>
                <td>${row.L}</td>
                <td>${row.T}</td>
                <td>${row.Pct}</td>
              </tr>`).join("")}
          </tbody>
        </table>
      `;

      setTimeout(() => {
        const filterCol = $("#filterCol");
        const filterInput = $("#filterInput");
        const applyBtn = $("#applyFilter");
        const clearBtn = $("#clearFilter");
        const table = $("#standingsTable");

        applyBtn.addEventListener("click", () => {
          const col = filterCol.value;
          const val = filterInput.value.trim().toLowerCase();
          if (!col || !val) return;
          const colIndex = filterOptions.indexOf(col);
          const rows = table.querySelectorAll("tbody tr");
          rows.forEach(r => {
            const cell = r.children[colIndex].textContent.toLowerCase();
            r.style.display = cell.includes(val) ? "" : "none";
          });
        });

        clearBtn.addEventListener("click", () => {
          filterCol.value = "";
          filterInput.value = "";
          table.querySelectorAll("tbody tr").forEach(r => r.style.display = "");
        });
      }, 0);

      return tableHtml;
    }

    async function fetchStandings(season) {
      const url = buildUrl(season);
      const res = await fetch(url, { headers: { "Accept":"application/xml" }});
      const xmlText = await res.text();
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const doc = new DOMParser().parseFromString(xmlText, "application/xml");
      if (doc.getElementsByTagName("parsererror").length) throw new Error("Invalid XML");
      return doc;
    }

    $("#form").addEventListener("submit", async e => {
      e.preventDefault();
      const input = $("#prompt");
      const text = input.value.trim();
      if (!text) return;
      addMsg(text, "me");
      input.value = "";
      const m = text.match(seasonRegex);
      if (!m) return addMsg("Enter a season like <code>2024REG</code>.", "bot");

      const season = `${m[1]}${m[2].toUpperCase()}`;
      addMsg(`Fetching standings for <strong>${season}</strong>‚Ä¶`, "bot");

      try {
        const xmlDoc = await fetchStandings(season);
        const table = renderStandingsTable(xmlDoc);
        messages.lastElementChild.innerHTML = `<div><strong>${season}</strong> Standings:</div>${table}`;
      } catch (err) {
        messages.lastElementChild.innerHTML = `<div class="error">Failed to load ${season}: ${err.message}</div>`;
      }
    });
</script>
</body>
</html>
